<template name="msgItem">
  <view wx:key="id" style="display:inline-block;">
    <text wx:if="{{type=='text'}}" style="padding:0;margin:0;width:auto;">{{text}}{{type}}</text>
    <image wx:if="{{type=='image'}}" style="width:100px;height:100px;vertical-align:middle;margin:0 3px;" src="{{url}}"/>
  </view>
</template>

<scroll-view scroll-y="true" scroll-top="100000000000000000" bindtap="tapscroll" style="height:{{height-50}}px;background:#eee" animation="{{animation_2}}">
  <view wx:for="{{messages}}" wx:for-item="i" wx:key="i.id">
    <view class="padding clearfix" wx:if="{{i.me}}">
      <image class="right-Avatar padding_half" src="{{i.avatar}}"></image>
      <view class="right-Triangle"></view>
      <view class="right-message padding_half">
        <template is="msgItem" data="{{...i}}" />
        <image wx:if="{{i.imgList}}" style="max-width:150px;max-height:120px" src="{{i.imgList}}"></image>
        <map wx:if="{{i.map}}" style="width: 220px; height: 160px;" latitude="{{latitude}}" longitude="{{longitude}}" scale="16" markers="{{markers}}" covers="{{covers}}">
        </map>
      </view>
    </view>
    <view class="padding clearfix" wx:if="{{!i.me}}">
      <image class="left-Avatar padding_half" src="{{i.avatar}}"></image>
      <view class="left-Triangle"></view>
      <view class="left-message padding_half">
        <template is="msgItem" data="{{...i}}" />
      </view>
    </view>
  </view>
  <view class="weui-icon_success"></view>
</scroll-view>
<!--底部发送栏  -->
<view class="wa-row">
  <view class="text-center" style="height:32px;line-height:32px">
    <image src='{{voiceButton}}' style="width:32px;height:32px;line-height:50px;" bindtap="getvoice" />
  </view>
  <view style="flex:1;border:1px solid gray;margin:0 5px">
    <input class='wa-input' confirm-type='send' placeholder="请输入消息" value="{{msg}}" bindinput="setMessage" bindconfirm="sendMessage" />
  </view>
  <!--选择表情  -->
  <view class="text-center" style="height:32px;line-height:32px;width:32px" bindtap="emotionBtn">
    <image src='{{emotionButton}}' style="height:32px;line-height:32px;width:32px" />
  </view>
  <!--判断显示更多功能还是发送表情  -->
  <view wx:if="{{!emotionBox}}" class="text-center" style="margin-left:5px;height:32px;line-height:32px" bindtap="elseBtn">
    <image src='{{moreButton}}' style="height:32px;line-height:32px;width:32px" />
  </view>
  <view wx:if="{{emotionBox}}" class="text-center" style="margin-left:5px;height:32px;line-height:32px" bindtap="sendEmotion">
    <image src='{{sendButton}}' style="height:32px;line-height:32px;width:32px" />
  </view>
</view>
<!--更多功能  -->
<view id="elsePanel" wx:if="{{moreBox}}" animation="{{animation}}">
  <view class="wa-row">
    <image class="moreImage" bindtap="chooseImg" src="/images/message/image.png"></image>
    <image class="moreImage" bindtap="getlocat" src="/images/message/map.png"></image>
  </view>
</view>
<!--选择表情  -->
<view id="emotionPanel" wx:if="{{emotionBox}}" animation="{{animation}}">
  <image class="emotion" wx:for="{{ emotions }}" wx:key="item.id" src="{{item.src}}" data-name="{{item.name}}" bindtap="chooseEmotion"></image>
</view>